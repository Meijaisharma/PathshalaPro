<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PathshalaX App</title>
    <script defer>
    document.body.appendChild(document.createElement('div')).setAttribute('id','chatBubbleRoot');
    window.agx = '6934343387f32926e0ce98c7nh68JtWTZWMcl+4M7hhx0Q==|j60xUyLrrN6uagKuD9uuWwxutxoXrdgRUbh4ouR1n8U=';
    </script>
    <script defer src="https://storage.googleapis.com/agentx-cdn-01/agentx-chat.js"></script>
    
    <style>
        :root { --primary: #5a4bda; --header-bg: #1E1E1E; --header-text: #FFFFFF; --bg: #F5F7FB; --card-bg: #FFFFFF; --text: #1B2124; --text-light: #757575; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background: var(--bg); color: var(--text); -webkit-tap-highlight-color: transparent; }
        .app-container { width: 100%; max-width: 480px; margin: 0 auto; background: var(--bg); min-height: 100vh; position: relative; overflow-x: hidden; }

        /* VIEW 1: HOME */
        #homeView { display: block; }
        .home-header { padding: 15px 20px; background: var(--header-bg); color: var(--header-text); position: sticky; top: 0; z-index: 10; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .header-logo { width: 28px; height: 28px; fill: var(--header-text); }
        .brand-name { font-size: 22px; font-weight: 700; letter-spacing: 0.5px; }

        .pill-tabs { display: flex; gap: 10px; padding: 15px 20px; overflow-x: auto; scrollbar-width: none; background: var(--bg); }
        .pill-tab { padding: 8px 20px; background: white; border: 1px solid #ddd; border-radius: 20px; font-size: 13px; font-weight: 600; color: var(--text-light); white-space: nowrap; cursor: pointer; transition: all 0.2s; }
        .pill-tab.active { background: var(--primary); color: white; border-color: var(--primary); }

        .content-list { padding: 0 15px 80px 15px; }
        .lecture-card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 12px; display: flex; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.04); cursor: pointer; border: 1px solid transparent; transition: transform 0.1s; }
        .lecture-card:active { transform: scale(0.98); }
        .play-btn-circle { width: 42px; height: 42px; background: #EEF1FF; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary); font-size: 16px; margin-right: 15px; flex-shrink: 0; }
        .card-details { flex: 1; }
        .card-title { font-size: 14px; font-weight: 700; color: var(--text); margin-bottom: 4px; line-height: 1.4; }
        .card-meta { font-size: 11px; color: var(--text-light); font-weight: 500; }
        .pdf-card { border-left: 4px solid #FF5252; }
        .pdf-btn-circle { background: #FFF0F0; color: #FF5252; }
        .dl-btn { display: inline-block; margin-top: 8px; background: var(--text); color: white; padding: 6px 12px; border-radius: 6px; font-size: 11px; text-decoration: none; font-weight: 600; }
        .open-btn { display: inline-block; margin-top: 8px; background: transparent; color: var(--primary); border: 1px solid var(--primary); padding: 5px 11px; border-radius: 6px; font-size: 11px; text-decoration: none; font-weight: 600; margin-right: 5px; }

        /* VIEW 2: PLAYER */
        #playerView { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 20; overflow-y: auto; }
        .player-header { position: sticky; top: 0; z-index: 100; background: black; width: 100%; aspect-ratio: 16/9; }
        video { width: 100%; height: 100%; object-fit: contain; }
        .back-btn-overlay { position: absolute; top: 15px; left: 15px; z-index: 101; background: rgba(0,0,0,0.5); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; cursor: pointer; font-size: 18px; backdrop-filter: blur(4px); }
        
        .info-box { padding: 20px; border-bottom: 1px solid #f0f0f0; position: relative; }
        .video-main-title { font-size: 18px; font-weight: 700; color: var(--text); line-height: 1.3; margin-bottom: 8px; }
        .video-sub-meta { font-size: 12px; color: var(--text-light); }
        
        .action-tabs { display: flex; justify-content: space-around; border-bottom: 1px solid #f0f0f0; padding: 10px 0; background: white; }
        .action-tab { display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; color: var(--text-light); width: 20%; }
        .action-tab.active { color: var(--primary); }
        .tab-content { padding: 0; min-height: 300px; background: var(--bg); }
        .tab-pane { display: none; padding: 20px; }
        .tab-pane.active { display: block; }
        
        /* Telegram Description Style */
        .telegram-desc { font-size: 14px; line-height: 1.6; color: #333; white-space: pre-wrap; background: white; padding: 15px; border-radius: 8px; border: 1px solid #eee; }

        /* Chat UI */
        .chat-container { display: flex; flex-direction: column; height: 300px; background: white; border-radius: 12px; border: 1px solid #eee; overflow: hidden; }
        .chat-messages { flex: 1; padding: 15px; background: #f9f9f9; text-align: center; color: #999; font-size: 13px; display: flex; align-items: center; justify-content: center; }
        .chat-input-box { padding: 10px; border-top: 1px solid #eee; display: flex; gap: 8px; }
        .chat-input { flex: 1; border: 1px solid #ddd; border-radius: 20px; padding: 8px 15px; font-size: 13px; outline: none; }
        .chat-send { background: var(--primary); color: white; width: 35px; height: 35px; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="homeView">
        <div class="home-header">
            <svg class="header-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 7L12 12L22 7L12 2Z"/>
                <path d="M2 17L12 22L22 17"/>
                <path d="M2 12L12 17L22 12"/>
            </svg>
            <div class="brand-name">PathshalaX</div>
        </div>
        <div class="pill-tabs">
            <div class="pill-tab active" onclick="filterHome('lectures', this)">Lectures</div>
            <div class="pill-tab" onclick="filterHome('notes', this)">PDF Notes</div>
            <div class="pill-tab" onclick="filterHome('doubts', this)">Doubts</div>
        </div>
        <div id="homeContent" class="content-list"></div>
    </div>

    <div id="playerView">
        <div class="player-header">
            <div class="back-btn-overlay" onclick="closePlayer()">‚Üê</div>
            <video id="videoPlayer" controls playsinline controlsList="nodownload">
                Your browser does not support video.
            </video>
        </div>
        <div class="info-box">
            <div class="video-main-title" id="playerTitle">Loading...</div>
            <div class="video-sub-meta">Hindi Sahitya ‚Ä¢ Jai Sir</div>
        </div>
        <div class="action-tabs">
            <div class="action-tab active" onclick="switchPlayerTab('info', this)">
                <span style="font-size:20px">‚ÑπÔ∏è</span><span style="font-size:10px;font-weight:600">Details</span>
            </div>
            <div class="action-tab" onclick="switchPlayerTab('notes', this)">
                <span style="font-size:20px">üìÑ</span><span style="font-size:10px;font-weight:600">Notes</span>
            </div>
            <div class="action-tab" onclick="switchPlayerTab('chat', this)">
                <span style="font-size:20px">üí¨</span><span style="font-size:10px;font-weight:600">Chat</span>
            </div>
        </div>

        <div class="tab-content">
            <div id="tab-info" class="tab-pane active">
                <h4 style="margin:0 0 10px 0; color:#555;">Lecture Details</h4>
                <div id="telegramDetails" class="telegram-desc">Fetching details from Telegram...</div>
            </div>

            <div id="tab-notes" class="tab-pane">
                <div id="playerNotesContainer"></div>
            </div>

            <div id="tab-chat" class="tab-pane">
                <div class="chat-container">
                    <div class="chat-messages">
                        <div><div style="font-size:30px; margin-bottom:10px;">üëã</div>Ask your doubts here.</div>
                    </div>
                    <div class="chat-input-box">
                        <input type="text" class="chat-input" placeholder="Type a message...">
                        <button class="chat-send">‚û§</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const homeContent = document.getElementById('homeContent');
    const playerNotesContainer = document.getElementById('playerNotesContainer');
    
    // Generate Lectures
    let lecturesHTML = '';
    for(let i=1; i<=157; i++){
        lecturesHTML += `
            <div class="lecture-card" onclick="openPlayer(${i})">
                <div class="play-btn-circle">‚ñ∂</div>
                <div class="card-details">
                    <div class="card-title">Lecture ${i}</div>
                    <div class="card-meta">Tap to watch ‚Ä¢ Jai Sir</div>
                </div>
                <div class="card-arrow">‚ùØ</div>
            </div>`;
    }

    // Generate Notes
    let notesHTML = '';
    let noteCount = 1;
    for(let i=202; i<=289; i++){
        notesHTML += `
            <div class="lecture-card pdf-card">
                <div class="play-btn-circle pdf-btn-circle">üìÑ</div>
                <div class="card-details">
                    <div class="card-title">Class Note ${noteCount}</div>
                    <div class="card-meta">PDF Document</div>
                    <div>
                        <a href="/api/pdf/${i}" target="_blank" class="open-btn">Open</a>
                        <a href="/api/pdf/${i}" download class="dl-btn">Download</a>
                    </div>
                </div>
            </div>`;
        noteCount++;
    }

    homeContent.innerHTML = lecturesHTML;
    playerNotesContainer.innerHTML = notesHTML;

    window.filterHome = function(type, btn) {
        document.querySelectorAll('.pill-tab').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        if(type === 'lectures') homeContent.innerHTML = lecturesHTML;
        else if(type === 'notes') homeContent.innerHTML = notesHTML;
        else homeContent.innerHTML = `<div style="text-align:center; padding:50px; color:#999;">No Doubts Raised Yet</div>`;
    }

    window.openPlayer = function(id) {
        document.getElementById('homeView').style.display = 'none';
        document.getElementById('playerView').style.display = 'block';
        
        // 1. Play Video
        const vid = document.getElementById('videoPlayer');
        vid.src = `/api/video/${id}`;
        vid.play();
        
        // 2. Set Basic Title
        document.getElementById('playerTitle').innerText = `Lecture ${id}`;
        
        // 3. FETCH TELEGRAM CAPTION (The Feature You Asked For)
        const detailsBox = document.getElementById('telegramDetails');
        detailsBox.innerText = "Fetching details from Telegram..."; // Reset text
        
        fetch(`/api/meta/${id}`)
            .then(res => res.json())
            .then(data => {
                if(data.text) {
                    detailsBox.innerText = data.text; // Show Real Caption
                    
                    // Try to set Title from first line of caption
                    const firstLine = data.text.split('\n')[0];
                    if(firstLine && firstLine.length < 50) {
                        document.getElementById('playerTitle').innerText = firstLine;
                    }
                }
            })
            .catch(err => {
                detailsBox.innerText = "Could not load details.";
            });

        // Open Info Tab by default
        switchPlayerTab('info', document.querySelectorAll('.action-tab')[0]);
    }

    window.closePlayer = function() {
        document.getElementById('videoPlayer').pause();
        document.getElementById('playerView').style.display = 'none';
        document.getElementById('homeView').style.display = 'block';
    }

    window.switchPlayerTab = function(tabName, btn) {
        document.querySelectorAll('.action-tab').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
        document.getElementById(`tab-${tabName}`).classList.add('active');
    }
</script>
</body>
</html>

